"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[835],{3835:function(t,e,r){r.r(e),r.d(e,{default:function(){return D}});var n=r(2791),i=r(5953),a=r(6015),l=r(4565),o=r(2069),s=r(2140),c=r(184),h=function(){return(0,c.jsx)(i.ZP,{container:!0,alignContent:"stretch",alignItems:"stretch",height:"100vh",sx:{overflow:"hidden",background:"black"}})},d=r(925),u=r(8387),f=r(4162),v=r(1487),x=r(6815),g=r(2482),m={low:v.Z[600],medium:"#ffb600",high:x.Z[600]},p=g.Z.A400,j=r(2865),y=r(1413),Z=r(885),w=r(1842),b=r(6084),k=r(5461),C=(0,n.createContext)();function I(t){var e=t.children,r=(0,n.useMemo)((function(){return k.find((function(t){return"food-waste"===t.id}))}),[k]),i=(0,n.useContext)(b.R).google,a=(0,n.useState)(),l=(0,Z.Z)(a,2),o=l[0],s=l[1],h=(0,n.useState)(),d=(0,Z.Z)(h,2),u=d[0],f=d[1],v=(0,n.useState)(),x=(0,Z.Z)(v,2),g=x[0],m=(x[1],(0,n.useState)()),p=(0,Z.Z)(m,2),j=p[0],I=p[1];(0,n.useEffect)((function(){i&&((0,w.xd)({chartData:(0,y.Z)((0,y.Z)({},r.screen.dailyFoodWasteGoal),{},{sheetId:r.sheetId}),google:i}).then((function(t){var e,r,n,i,a;I(Math.round(null===t||void 0===t||null===(e=t.Ta)||void 0===e||null===(r=e.Wf)||void 0===r||null===(n=r[0])||void 0===n||null===(i=n.c)||void 0===i||null===(a=i[0])||void 0===a?void 0:a.v))})).catch((function(t){console.log(t)})),(0,w.xd)({chartData:(0,y.Z)((0,y.Z)({},r.screen.historical),{},{sheetId:r.sheetId}),google:i}).then((function(t){var e,r=((null===t||void 0===t||null===(e=t.Ta)||void 0===e?void 0:e.Wf)||[]).map((function(t){var e,r,n,i;return{timestamp:new Date(null===t||void 0===t||null===(e=t.c)||void 0===e||null===(r=e[0])||void 0===r?void 0:r.v),value:Math.round(null===t||void 0===t||null===(n=t.c)||void 0===n||null===(i=n[1])||void 0===i?void 0:i.v)}}));s(r)})).catch((function(t){console.log(t)})),(0,w.xd)({chartData:(0,y.Z)((0,y.Z)({},r.screen.lastWeek),{},{sheetId:r.sheetId}),google:i}).then((function(t){var e,r,n,i,a;f(null===t||void 0===t||null===(e=t.Ta)||void 0===e||null===(r=e.Wf)||void 0===r||null===(n=r[0])||void 0===n||null===(i=n.c)||void 0===i||null===(a=i[0])||void 0===a?void 0:a.v)})).catch((function(t){console.log(t)})))}),[i]);var W=(0,n.useMemo)((function(){return{historical:o,lastWeek:u,lastSemester:g,dailyGoal:j}}),[o,u,g,j]);return(0,c.jsx)(C.Provider,{value:W,children:e})}var W=function(t){var e=t.current,r=t.comparedWith,n=t.periodLabel;if(null==e||null==r)return null;var i=Math.round(2*e),a=Math.round(2*r)-i,o=e<r?m.low:e===r?m.medium:m.high;return(0,c.jsxs)(f.Z,{alignItems:"center",children:[(0,c.jsxs)(f.Z,{direction:"row",gap:1,alignItems:"end",children:[(0,c.jsxs)(l.Z,{variant:"h4",color:o,display:"inline",mb:-.5,children:[(0,c.jsx)(l.Z,{variant:"h2",color:o,display:"inline",children:Math.abs(a)}),"\xa0meals"]}),(0,c.jsxs)(f.Z,{display:"inline-flex",direction:"column",children:[(0,c.jsx)(l.Z,{variant:"h4",color:o,component:"span",mb:-1.5,children:a>0?(0,c.jsx)(c.Fragment,{children:"\u25bc"}):(0,c.jsx)(c.Fragment,{children:"\u25b2"})}),(0,c.jsx)(l.Z,{variant:"h6",color:o,component:"span",children:a>0?(0,c.jsx)(c.Fragment,{children:"less"}):(0,c.jsx)(c.Fragment,{children:"more"})})]})]}),(0,c.jsxs)(l.Z,{variant:"h4",color:p,children:["than ",n]})]})},R=function(){var t,e=(0,n.useContext)(s.s).isLayoutReversed,r=(0,n.useContext)(C),a=r.historical,o=r.lastWeek,h=r.lastSemester,d=r.dailyGoal,u=(null===a||void 0===a?void 0:a[0])||{timestamp:null,value:null},v=function(){if(!u.value||!d)return null;var t=u.value/d;return t<.9?m.low:t<=1.1?m.medium:m.high}();return(0,c.jsxs)(f.Z,{direction:"column",justifyContent:"space-between",height:"100%",textAlign:"center",children:[(0,c.jsxs)(f.Z,{py:3,px:3,sx:{background:"unset"},children:[(0,c.jsx)(l.Z,{fontWeight:"500",color:"white",children:(0,c.jsx)(j.iF,{mode:"single",children:"GOAL: Keep Daily Food Waste Under"})}),(0,c.jsxs)(l.Z,{variant:"h2",color:m.low,children:[d||"--"," kg"]})]}),(0,c.jsxs)(f.Z,{py:3,px:3,flex:1,justifyContent:"space-between",children:[(0,c.jsxs)(f.Z,{flex:1,justifyContent:"space-evenly",sx:{"& .flashingRed":{"& .MuiTypography-root ":{color:"".concat(m.high," !important"),opacity:.8},color:"".concat(m.high," !important"),animation:"flashingRed 3s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes flashingRed":{"0%":{opacity:1},"50%":{opacity:.5},"100%":{opacity:1}}}},children:[u.value?(0,c.jsxs)(f.Z,{px:2,alignItems:"center",children:[(0,c.jsxs)(f.Z,{width:"100%",direction:"row",alignItems:"baseline",children:[(0,c.jsx)(l.Z,{flex:1,color:v,className:"".concat(v===m.high&&"flashingRed"),children:(0,c.jsxs)(j.iF,{mode:"single",children:[u.value," kg =\xa0",2*u.value]})}),(0,c.jsx)(l.Z,{variant:"h4",color:v,className:"".concat(v===m.high&&"flashingRed"),children:"\xa0meals*"})]}),(0,c.jsx)(l.Z,{width:"75%",color:p,children:(0,c.jsx)(j.iF,{mode:"single",children:"thrown in the garbage"})})]}):(0,c.jsx)(l.Z,{variant:"h1",color:p,children:"--"}),(0,c.jsx)(l.Z,{variant:"h4",color:p,children:(null===(t=u.timestamp)||void 0===t?void 0:t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}))||"--"}),(0,c.jsxs)(i.ZP,{container:!0,item:!0,children:[u.value&&o&&(0,c.jsx)(i.ZP,{item:!0,xs:6,children:(0,c.jsx)(W,{current:u.value,comparedWith:o,periodLabel:"last week avg"})}),u.value&&h&&(0,c.jsx)(i.ZP,{item:!0,xs:6,children:(0,c.jsx)(W,{current:u.value,comparedWith:h,periodLabel:"last semester avg"})})]})]}),(0,c.jsx)(l.Z,{variant:"h6",color:"white",textAlign:e?"right":"left",children:"*1 meal ~ 0.5 kg food waste"})]})]})},Y=r(7762),F=r(879),M=r(3802),P=r(4142),S=10,A=function(){var t,e,r,i,l=(0,P.Z)(),o=(0,n.useContext)(C),s=o.historical,h=o.dailyGoal,d=[{historical:s}],u=[{id:0,caterogy:"low",color:m.low,threshold:{low:0,high:h}},{id:0,caterogy:"high",color:m.high,threshold:{low:h,high:1/0}}],f=(0,n.useRef)(),v=(0,n.useRef)(),x=(0,n.useRef)(),g=(0,n.useRef)(),j=(0,n.useRef)(),y=0,w=1/0,b=30,k=80,I=70,W=F.jvg().x((function(t){return r(t.timestamp)})).y((function(t){return i(t.value)})).curve(F.YY7.tension(0));return(0,n.useEffect)((function(){var n,a;if(d&&s&&f.current&&v.current&&x.current&&g.current&&j.current){var o=(null===d||void 0===d||null===(n=d[0])||void 0===n||null===(a=n.metadata)||void 0===a?void 0:a.viewHours)||6;Math.floor(o/6);t=f.current.clientWidth,e=f.current.clientHeight-b,F.Ys(v.current).selectAll("*").remove(),F.Ys(x.current).selectAll("*").remove(),F.Ys(g.current).selectAll("*").remove(),F.Ys(j.current).selectAll("*").remove(),F.Ys(v.current).attr("opacity",.6),Object.entries(d).forEach((function(t){var e=(0,Z.Z)(t,2),r=(e[0],e[1]);if(r.historical&&Array.isArray(r.historical)){var n=F.Fp7(r.historical,(function(t){return t.value})),i=F.VV$(r.historical,(function(t){return t.value}));n>y&&(y=n),i<w&&(w=i)}})),y=Math.ceil(y/S)*S,w=Math.floor(w/S)*S;var c=20;y%c===0&&(y+=S),w%c===0&&(w-=S);var m,C=(0,Y.Z)(u);try{for(C.s();!(m=C.n()).done;){var R=m.value;if(y>=R.threshold.low&&y<=R.threshold.high){y=R.threshold.high===1/0?y:R.threshold.high;break}}}catch(H){C.e(H)}finally{C.f()}var P=d.flatMap((function(t){return(t.historical||[]).map((function(t){return t.timestamp}))})),A=F.Wem(P),D=(0,Z.Z)(A,2),E=D[0],q=D[1];r=F.Xf().domain([E,q]).rangeRound([I,t-k]),i=F.BYU().domain([w,y]).range([e+b,b]);for(var B=Math.floor(50/3),L=0;L<u.length;L++){var z=u[L],T=z.threshold.high===1/0?y:z.threshold.high,G=z.threshold.low;if(y<=G)break;var N=T-G;F.Ys(v.current).append("rect").attr("x",0).attr("y",e-T/y*e+b).attr("width",t).attr("height",N/y*e).attr("fill",z.color);var O=new Set;O.add(h);for(var U=h+c;U<=y;U+=c)O.add(U);for(var _=h-c;_>=w;_-=c)O.add(_);O.forEach((function(t){var e=t===h,r=i(t);if(e){var n=r,a=["".concat(0,",",n-12.5),"".concat(0,",",n+12.5),"".concat(25,",").concat(n)].join(" ");F.Ys(x.current).append("polygon").attr("points",a).attr("fill","#fff").attr("filter","none")}else F.Ys(x.current).append("line").attr("x1",0).attr("x2",B).attr("y1",r).attr("y2",r).attr("stroke","#ffffff").attr("stroke-width",2).attr("filter","none");F.Ys(x.current).append("text").attr("x",B+10).attr("y",r).attr("fill","#fff").attr("font-size",e?50:25).attr("alignment-baseline","middle").attr("filter","none").text(t)}))}F.Ys(g.current).append("rect").attr("x",0).attr("y",0).attr("width",t).attr("height",b).attr("fill","white"),F.Ys(g.current).selectAll("line").attr("stroke","white").attr("stroke-width",2).attr("opacity",.5),Object.entries(d).forEach((function(t,n){var a,o,s=(0,Z.Z)(t,2),c=(s[0],s[1]);F.Ys(j.current).append("path").datum(c.historical||[]).attr("x",I).attr("class","line").attr("d",W).attr("fill","transparent").attr("stroke","black").attr("stroke-width","5px").attr("opacity",n%2===0?1:.5);var h,d,u=(null===(a=c.historical)||void 0===a?void 0:a.length)>0?null===(o=c.historical)||void 0===o?void 0:o[0]:null;if(u&&u.aqi&&void 0!==u.aqi.value&&null!==u.aqi.value&&u.timestamp){var f,v,x,g=F.Ys(j.current).append("g").attr("transform","translate("+r(u.timestamp)+","+i(u.aqi.value)+")").attr("fill",null!==(null===c||void 0===c||null===(f=c.current)||void 0===f||null===(v=f.aqi)||void 0===v?void 0:v.categoryIndex)?l.palette.text.aqi[c.current.aqi.categoryIndex]:p);g.append("circle").attr("cx",0).attr("cy",0).attr("filter","brightness(0.5)").attr("class","pulse-ring").attr("r",25),g.append("circle").attr("cx",0).attr("cy",0).attr("stroke","#666").attr("class","pulse-dot").attr("r",10),g.append("text").attr("class","location-label").attr("x",15).attr("y",0).attr("fill","black").attr("alignment-baseline","middle").attr("text-anchor","left").attr("font-size",e/25).text((0,M.Fb)(null===(x=c.sensor)||void 0===x?void 0:x.location_short));for(var m=document.getElementsByClassName("location-label"),y=1;y<m.length;y++){var w=m[y-1],b=m[y],k=(h=w.getBoundingClientRect(),d=b.getBoundingClientRect(),h.bottom<d.top||h.top>d.bottom?0:h.top<d.top?-1:1);0!==k&&(w.setAttribute("y",10*k),b.setAttribute("y",10*-k))}}}))}}),[d]),(0,c.jsx)(a.Z,{sx:{"& .pulse-ring":{animation:"pulse-ring 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes pulse-ring":{"0%":{transform:"scale(0.2)"},"80%":{},"100%":{opacity:0}}},"& .pulse-dot":{animation:"pulse-dot 2s cubic-bezier(0.455, 0.03, 0.515, 0.955) infinite","@keyframes pulse-dot":{"0%":{transform:"scale(0.5)"},"50%":{transform:"scale(1)",filter:"brightness(1.2) contrast(1.2) saturate(1.2)"},"100%":{transform:"scale(0.5)"}}}},width:"100%",height:"100%",children:(0,c.jsxs)("svg",{id:"recent-historical-graph",width:"100%",height:"100%",ref:f,children:[(0,c.jsx)("g",{ref:v}),(0,c.jsx)("g",{ref:g}),(0,c.jsx)("g",{ref:x}),(0,c.jsx)("g",{ref:j})]})})},D=function(){var t=(0,n.useContext)(s.s),e=t.isLayoutReversed,r=t.shouldDisplayScreen,f=(0,n.useContext)(u.x),v=f.project,x=f.projectID;return(0,n.useEffect)((function(){v.title&&(document.title="".concat(v.title," Screen | CITIES Dashboard"))}),[v]),r?(0,c.jsx)(I,{children:(0,c.jsxs)(i.ZP,{container:!0,alignContent:"stretch",alignItems:"stretch",height:"100vh",sx:{cursor:"none",overflow:"hidden",background:"white","& *":{fontWeight:"500 !important"},"& .condensedFont":{fontFamily:"IBM Plex Sans Condensed, sans-serif !important","& *":{fontFamily:"IBM Plex Sans Condensed, sans-serif !important"}}},children:[(0,c.jsx)(i.ZP,{item:!0,xs:6,sx:{order:e?1:0,background:"#212529"},children:"food-waste"===x&&(0,c.jsx)(R,{})}),(0,c.jsxs)(i.ZP,{item:!0,xs:6,sx:{order:e?0:1},children:[(0,c.jsx)(a.Z,{sx:{position:"absolute",top:0,right:!e&&0,left:e&&0,width:"5vw",height:"5vw",m:1},children:(0,c.jsx)(o.Z,{})}),(0,c.jsxs)(i.ZP,{container:!0,alignContent:"space-between",justifyContent:"center",height:"100%",textAlign:"center",children:[(0,c.jsx)(i.ZP,{item:!0,xs:12,sx:{pt:3,px:2},children:(0,c.jsx)(l.Z,{variant:"h2",sx:{color:"black"},children:"CITIES Dashboard"})}),(0,c.jsx)(i.ZP,{item:!0,xs:2,children:(0,c.jsx)(a.Z,{height:"auto",width:"90%",children:(0,c.jsx)(d.ZP,{size:256,style:{height:"auto",maxWidth:"100%",width:"100%"},value:"https://citiesdashboard.com/project/".concat(x),viewBox:"0 0 256 256"})})}),(0,c.jsx)(i.ZP,{item:!0,xs:12,height:"70%",className:"condensedFont",sx:{"& *":{fontWeight:"600 !important"}},children:"food-waste"===x&&(0,c.jsx)(A,{})})]})]})]})}):(0,c.jsx)(h,{})}}}]);
//# sourceMappingURL=835.a37bc9a4.chunk.js.map