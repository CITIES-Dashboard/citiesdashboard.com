"use strict";(self.webpackChunkfront_end=self.webpackChunkfront_end||[]).push([[914],{4914:function(e,t,n){n.r(t),n.d(t,{default:function(){return ke}});var i=n(885),r=n(1413),s=n(5987),a=n(2791),o=n(6871),l=n(5973),c=n(229),d=n(3540),u=n(7568),h=n(1745),v=(n(472),n(5152)),x=n(5209),f=n(6015),p=n(803),m=n(5953),j=n(4565),Z=n(1872),g=n(4142),b=n(604),y=n(5461),w=n(1478),D=n(501),C=n(4281),k=n(4058),S=n(4853),P=n(3802),I=n(4942),T=n(2797),Y=n(7205),z=n(5399),L=n(7248),O=n(5450),M=n(6283),N=n(1680),B=n(9827),_=n(807),A=n(4390),F=n(9773),E=n(1803),U=n(1898),R=n(3057),W=n(324),H=n(4162),V=n(3978),q=n(230),K=n(8821),Q=n(1566),X=n(7170),G=n(5108),J=n(7438),$=n(1009),ee=n(7892),te=n.n(ee),ne=n(277),ie=n(3634),re=n(1652),se=n(4639),ae=n(6767),oe=n(822),le=n(8928),ce=n(3767),de=n(184),ue=["versionDates","day"],he=(0,ne.ZP)(se.H)((function(e){return{"&:after, :hover::after":{content:'"."',fontSize:"1.5rem",bottom:"-0.5rem",position:"absolute",color:e.theme.palette.primary.main,opacity:.5},"&:hover::after":{opacity:1}}}));function ve(e){var t=e.versionDates,n=void 0===t?[]:t,i=e.day,a=(0,s.Z)(e,ue);return n.indexOf(te()(i).format("YYYY-MM-DD"))>=0?(0,de.jsx)(he,(0,r.Z)((0,r.Z)({},a),{},{day:i})):(0,de.jsx)(se.H,(0,r.Z)((0,r.Z)({},a),{},{day:i}))}function xe(e){var t=e.smallScreen,n=e.onChange,i=e.versions.filter((function(e){return 10===e.version.length})).map((function(e){return e.version}));return(0,de.jsx)(ce.Z,{onClickAway:function(){return n("close")},children:(0,de.jsx)(le.Z,{sx:!t&&{position:"absolute",right:0,zIndex:999},raised:!0,children:(0,de.jsx)(re._,{dateAdapter:ie.y,children:(0,de.jsx)(ae.W,{loading:!i,format:"YYYY-MM-DD",renderLoading:function(){return(0,de.jsx)(oe.e,{})},slots:{day:ve},onChange:function(e,t){return"finish"===t?n(te()(e).format("YYYY-MM-DD")):null},slotProps:{day:{versionDates:i}},shouldDisableDate:function(e){return t=e,!(i.indexOf(te()(t).format("YYYY-MM-DD"))>=0);var t},disableHighlightToday:!0,minDate:te()(i.slice(-1)[0]),maxDate:te()(i[0])})})})})}function fe(e){var t=e.project,n=(0,a.useContext)(q.N),r=(0,a.useState)(),s=(0,i.Z)(r,2),o=s[0],l=s[1];(0,a.useEffect)((function(){t&&n&&l(n[null===t||void 0===t?void 0:t.id])}),[t,n]);var c=(0,g.Z)(),d=(0,T.Z)(c.breakpoints.down("sm")),u=(0,a.useState)(!1),h=(0,i.Z)(u,2),v=h[0],f=h[1],p=function(){return f(!1)};return(0,de.jsxs)(de.Fragment,{children:[(0,de.jsxs)(Y.Z,{onClick:function(){f(!0),J.y(J.z.rawDatasetButtonClicked,{project_id:t.id})},variant:"contained",children:[(0,de.jsx)(Q.Z,{sx:{fontSize:"1rem"}}),"\xa0Raw Dataset"]}),(0,de.jsxs)(z.Z,{open:v,onClose:p,maxWidth:"lg",fullWidth:!0,fullScreen:d,keepMounted:!0,children:[d&&(0,de.jsx)(L.Z,{sx:{justifyContent:"start"},children:(0,de.jsxs)(Y.Z,{autoFocus:!0,onClick:p,children:[(0,de.jsx)(X.Z,{sx:{fontSize:"1rem"}}),"Back"]})}),(0,de.jsxs)(O.Z,{children:[(0,de.jsx)(x.Z,{label:t.title,size:"small",sx:{mb:1}}),(0,de.jsx)(j.Z,{variant:"h6",children:"Preview and download raw dataset(s)"}),(0,de.jsx)(pe,{datasets:o,smallScreen:d,project:t}),o&&(0,de.jsxs)(j.Z,{variant:"caption",sx:{my:2,fontStyle:"italic",display:"block"},children:["This dataset is provided by the CITIES Dashboard with the support of ",t.owner,". Should you intend to utilize this dataset for your project, research, or publication, we kindly request that you notify us at ",(0,de.jsx)(M.Z,{href:"mailto:nyuad.cities@nyu.edu",children:"nyuad.cities@nyu.edu"})," to discuss citation requirements."]})]})]})]})}var pe=function(e){var t=e.datasets,n=e.smallScreen,s=e.project,o=(0,a.useState)(),l=(0,i.Z)(o,2),c=l[0],d=l[1],u=(0,a.useState)(),h=(0,i.Z)(u,2),v=h[0],x=h[1];return(0,a.useEffect)((function(){var e,n,i,s;(null===t||void 0===t?void 0:t.length)>0&&(d(null===(e=t[0])||void 0===e?void 0:e.versions[0]),x(null===(n=t[0])||void 0===n?void 0:n.id),(0,$.m)(null===(i=t[0])||void 0===i||null===(s=i.versions[0])||void 0===s?void 0:s.rawLink,"csv").then((function(e){var n;d((0,r.Z)((0,r.Z)({},null===(n=t[0])||void 0===n?void 0:n.versions[0]),{},{fetchedDataset:e}))})))}),[t]),(0,de.jsxs)(m.ZP,{container:!0,justifyContent:"center",alignItems:"start",spacing:3,children:[(0,de.jsx)(m.ZP,{item:!0,sm:12,md:6,children:(0,de.jsx)(me,{datasets:t,smallScreen:n,previewingDataset:c,setPreviewingDataset:d,previewingDatasetId:v,setPreviewingDatasetId:x})}),(0,de.jsx)(m.ZP,{item:!0,sm:12,md:6,maxWidth:n?"100%":"unset",sx:{mt:1},children:(0,de.jsx)(Ze,{previewingDataset:c,previewingDatasetId:v,project:s,smallScreen:n})})]})},me=function(e){var t=e.datasets,n=e.smallScreen,i=e.previewingDataset,r=e.setPreviewingDataset,s=e.previewingDatasetId,a=e.setPreviewingDatasetId;return(0,de.jsxs)(N.Z,{size:"small",sx:{tableLayout:"fixed","& td, div, .MuiMenuItem-root":{fontSize:n?"0.625rem":"0.8rem"}},children:[(0,de.jsx)(B.Z,{children:(0,de.jsxs)(_.Z,{children:[(0,de.jsx)(A.Z,{sx:{pl:1},children:"Dataset"}),(0,de.jsx)(A.Z,{sx:{width:n?"9.5rem":"11rem"},children:"Version"}),(0,de.jsx)(A.Z,{sx:{width:n?"5rem":"6rem"},children:"Size"})]})}),(0,de.jsx)(F.Z,{children:null===t||void 0===t?void 0:t.map((function(e){return(0,de.jsx)(je,{smallScreen:n,dataset:e,previewingDataset:i,setPreviewingDataset:r,isPreviewing:e.id===s,setPreviewingDatasetId:a},e.id)}))})]})},je=function(e){var t=e.smallScreen,n=e.dataset,s=e.setPreviewingDataset,o=e.isPreviewing,l=e.previewingDatasetId,c=e.setPreviewingDatasetId,d=(0,a.useState)({}),u=(0,i.Z)(d,2),h=u[0],x=u[1],f=(null===n||void 0===n?void 0:n.versions[0])||{},p=(0,a.useState)(!1),m=(0,i.Z)(p,2),j=m[0],Z=m[1],b=(0,a.useState)(f),y=(0,i.Z)(b,2),w=y[0],D=y[1],C=null===n||void 0===n?void 0:n.versions.slice(0,3);C.find((function(e){return e===w}))||C.push((0,r.Z)((0,r.Z)({},w),{},{isOlderVersion:!0}));var S=(null===n||void 0===n?void 0:n.versions.length)>3,P=function(e){var t=e.target.value;if("Calendar"!==t){var i=null===n||void 0===n?void 0:n.versions.find((function(e){return e.version===t}));D(i),c(n.id),s(i),Y(i)}else Z(!0)},T=function(e){Z(!1),"close"!==e&&P({target:{value:e}})},Y=function(e){h[e.version]?s(h[e.version]):(0,$.m)(e.rawLink,"csv").then((function(t){var n=(0,r.Z)((0,r.Z)({},e),{},{fetchedDataset:t});s(n),x((0,r.Z)((0,r.Z)({},h),{},(0,I.Z)({},n.version,n)))}))},z=function(){l!==n.id&&(c(n.id),s(w),Y(w))},L=(0,g.Z)();return(0,de.jsx)(de.Fragment,{children:(0,de.jsxs)(_.Z,{children:[(0,de.jsx)(A.Z,{sx:{pl:1,cursor:"pointer",background:o&&L.palette.background.NYUpurpleLight},onClick:z,children:null===w||void 0===w?void 0:w.name}),(0,de.jsxs)(A.Z,{sx:{position:"relative",background:o&&L.palette.background.NYUpurpleLight},children:[j&&(t?(0,de.jsx)(E.Z,{open:j,sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:(0,de.jsx)(xe,{onChange:T,smallScreen:t,versions:null===n||void 0===n?void 0:n.versions})}):(0,de.jsx)(xe,{onChange:T,versions:null===n||void 0===n?void 0:n.versions})),(0,de.jsx)(U.Z,{size:"small",children:(0,de.jsxs)(R.Z,{value:null===w||void 0===w?void 0:w.version,onClick:function(){n.versions.length<=1&&z()},onChange:P,variant:"standard",MenuProps:{disablePortal:!0},children:[C.map((function(e,t){return(0,de.jsx)(W.Z,{value:e.version,sx:[t===C.length-1&&{mb:-.75},e.isOlderVersion&&{marginTop:"1rem","&::before":{content:'""',borderTop:"2px dotted ".concat(L.palette.text.secondary),width:"1rem",height:"1rem",position:"absolute",top:0,left:"50%",transform:"translate(-50%, -50%)"}}],children:(0,de.jsxs)(H.Z,{direction:"row",alignItems:"center",children:[e.version,e===f&&(0,de.jsx)(v.Z,{title:"Latest version",enterDelay:0,leaveDelay:200,children:(0,de.jsx)(V.Z,{sx:{ml:.5,width:"1rem",height:"1rem",background:L.palette.success.main},children:(0,de.jsx)(k.Z,{sx:{width:"0.8rem",height:"0.8rem"}})})})]})},e.version)})),S&&(0,de.jsx)(W.Z,{value:"Calendar",sx:{pt:1,mt:1,mb:-.75,borderTop:"0.5px solid"},children:(0,de.jsxs)(H.Z,{direction:"row",alignItems:"center",children:["Older Versions",(0,de.jsx)(G.Z,{fontSize:"small",sx:{ml:.5}})]})},"Calendar")]})})]}),(0,de.jsx)(A.Z,{sx:{background:o&&L.palette.background.NYUpurpleLight},children:function(e){if(e)return e<1048576?(e/1024).toFixed(1)+" KB":(e/1048576).toFixed(1)+" MB"}(null===w||void 0===w?void 0:w.sizeInBytes)})]},n.id)})},Ze=function(e){var t=e.previewingDataset,n=e.previewingDatasetId,r=e.project,s=e.smallScreen,o="[".concat(r.id,"] ").concat(null===t||void 0===t?void 0:t.name,"-").concat(null===t||void 0===t?void 0:t.version,".csv"),l=(0,g.Z)(),c=(0,a.useState)(""),d=(0,i.Z)(c,2),u=d[0],h=d[1],v=(0,a.useState)(""),x=(0,i.Z)(v,2),p=x[0],m=x[1];return(0,a.useEffect)((function(){if(null!==t&&void 0!==t&&t.fetchedDataset){var e=null===t||void 0===t?void 0:t.fetchedDataset,n=e.split("\n"),i=n.length;if(i<=10)h(e),m(Array.from({length:i},(function(e,t){return t+1})).join("\n"));else{var r=n.slice(0,5),s=n.slice(i-5),a=i-10,o=["... [".concat(a," rows hidden] ...")];h(r.concat(o).concat(s).join("\n")),m(Array.from({length:11},(function(e,t){var n=t+1;return n<6?n:6===n?"":a+n-1})).join("\n"))}}}),[t]),(0,de.jsxs)(H.Z,{spacing:1,children:[(0,de.jsxs)(f.Z,{sx:{"& *":{fontFamily:"monospace !important"}},children:[(0,de.jsx)(H.Z,{direction:"row",children:(0,de.jsx)(j.Z,{variant:"body2",gutterBottom:!0,fontWeight:600,children:t?"Previewing: ".concat(t.name," (").concat(null===t||void 0===t?void 0:t.version,")"):"Not previewing any dataset"})}),(0,de.jsx)(f.Z,{component:"pre",sx:{overflowX:"auto",color:l.palette.text.secondary,backgroundColor:l.palette.customBackground,p:2,pt:1.5,borderRadius:l.spacing(1),borderTopLeftRadius:0,minHeight:"5rem",width:s?"100%":"unset",marginTop:0},children:(0,de.jsxs)(H.Z,{direction:"row",sx:{fontSize:s?"0.625rem !important":"0.8rem !important"},children:[(0,de.jsx)(f.Z,{sx:{mr:2,userSelect:"none"},children:p}),(0,de.jsx)(f.Z,{children:u})]})})]}),(0,de.jsx)(f.Z,{textAlign:"center",children:(0,de.jsxs)(Y.Z,{variant:"contained",sx:{textTransform:"none",textAlign:"left",lineHeight:1.1,px:1.5,py:1},onClick:function(){!function(){if(null!==t&&void 0!==t&&t.fetchedDataset){var e=new Blob([null===t||void 0===t?void 0:t.fetchedDataset],{type:"application/octet-stream"}),n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=o,document.body.appendChild(i),i.click(),URL.revokeObjectURL(n),document.body.removeChild(i)}}(),J.y(J.z.rawDatasetDownloaded,{project_id:r.id,dataset_id:n,dataset_name:t.name,dataset_version:t.version})},disabled:!t,children:[(0,de.jsx)(K.Z,{sx:{fontSize:"1.25rem",mr:.5}}),t?o:"No dataset available to download"]})})]})},ge=n(1131),be=n(6344);n(445);var ye=function(e){var t=e.text,n=e.wordLimit,r=void 0===n?60:n,s=e.reference,o=(0,a.useState)(!1),l=(0,i.Z)(o,2),c=l[0],u=l[1],h=(0,g.Z)(),v=(0,T.Z)(h.breakpoints.down("sm")),x=(0,a.useRef)(null),p=t.split(" ");if(!v||p.length/r<=1.4)return(0,de.jsxs)(f.Z,{children:[(0,de.jsx)(j.Z,{children:(0,d.ZP)(t,{replace:P.T1})}),s&&(0,de.jsx)(j.Z,{variant:"caption",color:"text.secondary",children:(0,d.ZP)(s,{replace:P.T1})})]});var m=p.slice(0,r).join(" "),Z=m.lastIndexOf(".");return-1!==Z&&(m=m.slice(0,Z+1)),(0,de.jsx)(ce.Z,{onClickAway:function(e){(function(e){for(var t=e.target,n=x.current.closest(".MuiContainer-root"),i=new Set(["rect","path","svg","circle"]);null!=t;){if(i.has(t.tagName))return t.closest(".MuiContainer-root")===n;t=t.parentNode}return!1})(e)||u(!1)},children:(0,de.jsx)(f.Z,{ref:x,onClick:function(){return u(!c)},style:{cursor:"pointer"},children:c?(0,de.jsxs)(de.Fragment,{children:[(0,de.jsx)(j.Z,{children:(0,d.ZP)(t,{replace:P.T1})}),s&&(0,de.jsx)(j.Z,{variant:"caption",color:"text.secondary",children:(0,d.ZP)(s,{replace:P.T1})})]}):(0,de.jsxs)(de.Fragment,{children:[(0,de.jsxs)(j.Z,{display:"inline",children:[(0,d.ZP)(m,{replace:P.T1}),"..."]}),(0,de.jsx)(j.Z,{display:"inline",color:"text.primary",fontWeight:"500",sx:{ml:.5,"& :hover":{textDecoration:"underline"}},children:"See more"})]})})})},we=n(9132),De=["tooltipTitle"],Ce=function(e){var t=e.tooltipTitle,n=(0,s.Z)(e,De);return(0,de.jsx)(v.Z,{title:t,enterDelay:0,leaveDelay:200,children:(0,de.jsx)(x.Z,(0,r.Z)({size:"small"},n))})},ke=function(){var e=(0,a.useContext)(we.p).themePreference,t=(0,a.useContext)(l.F),n=t.setCurrentPage,s=t.chartsTitlesList,v=t.setChartsTitlesList,x=(0,a.useContext)(c.q),I=x.tab,T=x.setTab,Y=(0,o.UO)().id,z=(0,a.useState)({}),L=(0,i.Z)(z,2),O=L[0],M=L[1],N=(0,a.useState)(!1),B=(0,i.Z)(N,2),_=B[0],A=B[1],F=(0,o.s0)(),E=(0,a.useContext)(q.N),U=(0,a.useState)(null),R=(0,i.Z)(U,2),W=R[0],H=R[1],V=(0,g.Z)(),K=(0,a.useCallback)((function(e){return T(e)}),[T]),Q=(0,a.useCallback)((function(e){return F(e,{replace:!0})}),[F]);return(0,a.useEffect)((function(){var e=y.find((function(e){return e.id===Y})),t=[];if(e){M((0,r.Z)({},e));for(var i={},s=0;s<e.charts.length;s++)i[s]=0;K(i),A(!0),t=e.charts.map((function(e,t){return{chartTitle:e.title,chartID:"chart-".concat(t+1)}}))}else n("404"),Q("/404");n("project"),v(t)}),[Y,n,v,K,Q]),(0,a.useEffect)((function(){O.title&&(document.title="".concat(O.title," | CITIES Dashboard"))}),[O]),(0,a.useEffect)((function(){if(E){var e=E[O.id];if(e){var t=e.flatMap((function(e){return e.versions?e.versions[0].version:[]})),n=t.length>0?t.reduce((function(e,t){return e>t?e:t})):null;H(n)}}}),[E,O.id]),(0,de.jsx)(de.Fragment,{children:_&&(0,de.jsxs)(f.Z,{width:"100%",children:[(0,de.jsx)(be.Z,{backgroundColor:"customAlternateBackground",children:(0,de.jsxs)(p.Z,{sx:{pt:5,pb:3},children:[(0,de.jsx)(h.Z,{text:O.title}),(0,de.jsxs)(m.ZP,{container:!0,spacing:1,sx:{pb:3,mt:-3},children:[(0,de.jsx)(m.ZP,{item:!0,children:(0,de.jsx)(Ce,{icon:(0,de.jsx)(D.Z,{}),label:O.owner,tooltipTitle:"Dataset Owner"})}),(0,de.jsx)(m.ZP,{item:!0,children:(0,de.jsx)(Ce,{icon:(0,de.jsx)(C.Z,{}),label:O.contact,tooltipTitle:"Contact",component:"a",href:"mailto:".concat(O.contact),clickable:!0})}),(0,de.jsx)(m.ZP,{item:!0,children:(0,de.jsx)(Ce,{icon:(0,de.jsx)(S.Z,{}),label:"".concat(O.charts.length," Chart").concat(O.charts.length>1&&"s"),tooltipTitle:"Number of Charts",onClick:function(){(0,ge.Qj)(w.O3.id),J.y(J.z.internalNavigation,{destination_id:w.O3.id,destination_label:w.project.toString(),origin_id:"chip"})}})}),W&&(0,de.jsx)(m.ZP,{item:!0,children:(0,de.jsx)(Ce,{icon:(0,de.jsx)(k.Z,{}),label:"Last update: ".concat(W),tooltipTitle:"Last Update"})})]}),(0,de.jsx)(j.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{textAlign:"justify",pb:3,mb:0,"& table *":{color:"".concat(V.palette.text.secondary)}},gutterBottom:!0,children:O.description?(0,d.ZP)(O.description,{replace:P.T1}):"No project description"}),(0,de.jsx)(fe,{project:O})]})}),(0,de.jsx)(f.Z,{id:w.O3.id,children:O.charts.map((function(t,n){return(0,de.jsx)(be.Z,{id:s[n].chartID,backgroundColor:n%2!==0&&"customAlternateBackground",children:(0,de.jsxs)(p.Z,{sx:{pt:4,pb:4},height:"auto",className:e===b.Z.dark?"dark":"",children:[(0,de.jsxs)(j.Z,{variant:"h6",color:"text.primary",children:[n+1,". ",t.title]}),(0,de.jsx)(u.Z,{chartData:(0,r.Z)({chartIndex:n,sheetId:O.sheetId},t)}),(0,de.jsx)(f.Z,{sx:{my:3},children:(0,de.jsxs)(j.Z,{component:"div",variant:"body1",color:"text.secondary",sx:{mb:1},children:[t.subtitle&&(0,de.jsx)(ye,{text:t.subtitle,reference:t.reference?t.reference:void 0}),Number(Object.keys(I)[n])===n&&t.subcharts&&t.subcharts[Object.values(I)[n]].subchartSubtitle&&(0,de.jsx)(ye,{text:t.subcharts[Object.values(I)[n]].subchartSubtitle,reference:t.subcharts[Object.values(I)[n]].reference?t.subcharts[Object.values(I)[n]].reference:void 0})]})})]})},n)}))}),(0,de.jsx)(Z.Z,{})]})})}}}]);
//# sourceMappingURL=914.8f3f6890.chunk.js.map